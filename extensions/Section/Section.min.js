/*!
 * LMV v7.55.0
 *
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 *
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 *
 * Autodesk Forge Viewer Usage Limitations:
 *
 * The Autodesk Forge Viewer JavaScript must be delivered from an
 * Autodesk-hosted URL.
 */(()=>{var t={83427:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var i=n(87537),o=n.n(i),a=n(23645),r=n.n(a)()(o());r.push([t.id,".sectionPanel{line-height:14px;text-align:left;z-index:10}.section-horizontal-divider{height:1px;border-top:1px solid rgba(200,200,200,0.8)}.section-submenu-select{display:block;position:relative;width:calc(100% - 40px);padding:10px 20px 0px 20px;opacity:0.3}.section-panel:hover .section-submenu-select{opacity:0.8}.section-submenu-selectlabel{position:relative;display:inline-block;padding-right:20px;padding-bottom:4px}.section-restart{margin:10px 20px 15px 20px;padding:6px 10px 6px 10px;width:calc(100% - 55px);cursor:pointer}.docking-panel:hover .section-restart{background-color:rgba(255,255,255,0.12)}.docking-panel .section-restart:hover{background-color:rgba(166,194,255,0.7);-webkit-transition:all 0.2s ease;-moz-transition:all 0.2s ease;-ms-transition:all 0.2s ease;-o-transition:all 0.2s ease;transition:all 0.2s ease}\n","",{version:3,sources:["webpack://./extensions/Section/Section.css"],names:[],mappings:"AAGA,cACI,gBAAiB,CACjB,eAAgB,CAChB,UAAW,CACd,4BAIG,UAAW,CACX,0CAA2C,CAC9C,wBAIG,aAAc,CACd,iBAAkB,CAClB,uBAAwB,CACxB,0BAA2B,CAC3B,WAAY,CACf,6CAGE,WAAY,CACd,6BAIG,iBAAkB,CAClB,oBAAsB,CACtB,kBAAoB,CACpB,kBAAoB,CACvB,iBAGG,0BAA2B,CAC3B,yBAA0B,CAC1B,uBAAwB,CACxB,cAAe,CAClB,sCAGG,uCAAwC,CAC3C,sCAGG,sCAAwC,CACxC,gCAAiC,CACjC,6BAA8B,CAC9B,4BAA6B,CAC7B,2BAA4B,CAC5B,wBAAyB",sourcesContent:["/**\n * Section CSS\n **/\n.sectionPanel {\n    line-height: 14px;\n    text-align: left;\n    z-index: 10;\n}\n\n.section-horizontal-divider\n{\n    height: 1px;\n    border-top: 1px solid rgba(200,200,200,0.8);\n}\n\n.section-submenu-select\n{\n    display: block;\n    position: relative;\n    width: calc(100% - 40px);\n    padding: 10px 20px 0px 20px;\n    opacity: 0.3;\n}\n\n.section-panel:hover .section-submenu-select {\n   opacity: 0.8;\n}\n\n.section-submenu-selectlabel\n{\n    position: relative;\n    display:  inline-block;\n    padding-right:  20px;\n    padding-bottom:  4px;\n}\n\n.section-restart {\n    margin: 10px 20px 15px 20px;\n    padding: 6px 10px 6px 10px;\n    width: calc(100% - 55px);\n    cursor: pointer;\n}\n\n.docking-panel:hover .section-restart {\n    background-color: rgba(255,255,255, .12);\n}\n\n.docking-panel .section-restart:hover {\n    background-color: rgba(166,194,255, 0.7);\n    -webkit-transition: all 0.2s ease;\n    -moz-transition: all 0.2s ease;\n    -ms-transition: all 0.2s ease;\n    -o-transition: all 0.2s ease;\n    transition: all 0.2s ease;\n}\n\n"],sourceRoot:""}]);const s=r},23645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(r[c]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);i&&r[h[0]]||(void 0!==a&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=a),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),e.push(h))}},e}},87537:t=>{"use strict";t.exports=function(t){var e=t[1],n=t[3];if(!n)return e;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),a="/*# ".concat(o," */"),r=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[e].concat(r).concat([a]).join("\n")}return[e].join("\n")}},62705:(t,e,n)=>{var i=n(55639).Symbol;t.exports=i},44239:(t,e,n)=>{var i=n(62705),o=n(89607),a=n(2333),r=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":r&&r in Object(t)?o(t):a(t)}},27561:(t,e,n)=>{var i=n(67990),o=/^\s+/;t.exports=function(t){return t?t.slice(0,i(t)+1).replace(o,""):t}},31957:(t,e,n)=>{var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;t.exports=i},89607:(t,e,n)=>{var i=n(62705),o=Object.prototype,a=o.hasOwnProperty,r=o.toString,s=i?i.toStringTag:void 0;t.exports=function(t){var e=a.call(t,s),n=t[s];try{t[s]=void 0;var i=!0}catch(t){}var o=r.call(t);return i&&(e?t[s]=n:delete t[s]),o}},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},55639:(t,e,n)=>{var i=n(31957),o="object"==typeof self&&self&&self.Object===Object&&self,a=i||o||Function("return this")();t.exports=a},67990:t=>{var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},23279:(t,e,n)=>{var i=n(13218),o=n(7771),a=n(14841),r=Math.max,s=Math.min;t.exports=function(t,e,n){var c,l,h,u,p,E,d=0,f=!1,m=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function T(e){var n=c,i=l;return c=l=void 0,d=e,u=t.apply(i,n)}function w(t){return d=t,p=setTimeout(g,e),f?T(t):u}function y(t){var n=t-E;return void 0===E||n>=e||n<0||m&&t-d>=h}function g(){var t=o();if(y(t))return R(t);p=setTimeout(g,function(t){var n=e-(t-E);return m?s(n,h-(t-d)):n}(t))}function R(t){return p=void 0,v&&c?T(t):(c=l=void 0,u)}function x(){var t=o(),n=y(t);if(c=arguments,l=this,E=t,n){if(void 0===p)return w(E);if(m)return clearTimeout(p),p=setTimeout(g,e),T(E)}return void 0===p&&(p=setTimeout(g,e)),u}return e=a(e)||0,i(n)&&(f=!!n.leading,h=(m="maxWait"in n)?r(a(n.maxWait)||0,e):h,v="trailing"in n?!!n.trailing:v),x.cancel=function(){void 0!==p&&clearTimeout(p),d=0,c=E=l=p=void 0},x.flush=function(){return void 0===p?u:R(o())},x}},13218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},37005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},33448:(t,e,n)=>{var i=n(44239),o=n(37005);t.exports=function(t){return"symbol"==typeof t||o(t)&&"[object Symbol]"==i(t)}},7771:(t,e,n)=>{var i=n(55639);t.exports=function(){return i.Date.now()}},14841:(t,e,n)=>{var i=n(27561),o=n(13218),a=n(33448),r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(a(t))return NaN;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=i(t);var n=s.test(t);return n||c.test(t)?l(t.slice(2),n?2:8):r.test(t)?NaN:+t}},93379:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var a={},r=[],s=0;s<t.length;s++){var c=t[s],l=i.base?c[0]+i.base:c[0],h=a[l]||0,u="".concat(l," ").concat(h);a[l]=h+1;var p=n(u),E={css:c[1],media:c[2],sourceMap:c[3]};-1!==p?(e[p].references++,e[p].updater(E)):e.push({identifier:u,updater:o(E,i),references:1}),r.push(u)}return r}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var a=i(t=t||[],o=o||{});return function(t){t=t||[];for(var r=0;r<a.length;r++){var s=n(a[r]);e[s].references--}for(var c=i(t,o),l=0;l<a.length;l++){var h=n(a[l]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}a=c}}},90569:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e),e}},3565:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},7795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i=n.css,o=n.media,a=n.sourceMap;o?t.setAttribute("media",o):t.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(i,t)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},44589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{"use strict";n.r(i),n.d(i,{SectionExtension:()=>H});var t=function(t,e,n){return t.orthoPoint(e,n)},e=n(23279),o=null,a=Autodesk.Viewing.Private,r=function(n,i){var r,s,c,l=n.impl,h=["section"],u=!1,p=!1,E=!1,d=!0,f=i.tintColor,m=i.tintIntensity,v=isNaN(i.gizmoOffsetRight)?200:i.gizmoOffsetRight,T=isNaN(i.gizmoOffsetLeft)?80:i.gizmoOffsetLeft,w=isNaN(i.gizmoOffsetTop)?80:i.gizmoOffsetTop,y=isNaN(i.gizmoOffsetBottom)?80:i.gizmoOffsetBottom,g=new THREE.Vector3,R=new THREE.Vector3,x=new THREE.Vector3,H=[],b=[],M=[],P="",S="gizmo",A=null,B=!1,C=!0,V=[0,1,1,3,3,2,2,0],z=!0,k=e((function(t,e,n){a.analytics.track("viewer.section",{from:t,type:e,action:n})}),2e3);function I(){l.invalidate(!1,!1,!0)}function O(){G(),r&&r.update(),s&&s.update()}function G(){if(r&&r.object){var t=l.worldToClient(r.position),e=l.getCanvasBoundingClientRect();if(g.copy(t),t.x<T?g.x=T:t.x>e.width-v&&(g.x=e.width-v),t.y<w?g.y=w:t.y>e.height-y&&(g.y=e.height-y),g.x!==t.x||g.y!==t.y){var n=THREE.TransformControls.intersectObjects(g.x,g.y,[r.object],l.camera,!1);if(n){var i=H[0].position;R.copy(r.object.position).add(i),x.copy(n.point).sub(R),r.setGizmoOffset(x)}}}}function j(){u&&1===b.length&&(D(!0),O(),Y((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)))}!function(){var t=function(t){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var e=function(t){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.LineBasicMaterial.prototype);var n,i,o,a=function(t,e,n){var i=[];n=n||1;for(var o=0;o<=64*n;++o)"x"==e&&i.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(t)),"y"==e&&i.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(t)),"z"==e&&i.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(t));return(new THREE.BufferGeometry).setFromPoints(i)},r=function(t,e,n,i,o,a){return new THREE.CylinderBufferGeometry(t,e,n,i,o,a).applyMatrix4((new THREE.Matrix4).makeTranslation(0,.5,0))},s=function(t){var e=new THREE.Geometry;return"X"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===t&&e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),e};THREE.TransformGizmo=function(t){var e=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var t=new THREE.PlaneBufferGeometry(50,50,2,2),e=new THREE.MeshBasicMaterial({wireframe:!0});e.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(t,e),YZ:new THREE.Mesh(t,e),XZ:new THREE.Mesh(t,e),XYZE:new THREE.Mesh(t,e)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse((function(t){if(t instanceof THREE.Mesh){t.updateMatrix();var e=t.geometry.clone();e.applyMatrix4(t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}}))},this.hide=function(){this.traverse((function(t){t.visible=!1}))},this.show=function(){this.traverse((function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?e.material.highlight(!0):e.material.highlight(!1))}))},this.setupGizmos=function(){var e=function(t,e){for(var n in t)for(var i=t[n].length;i--;){var o=t[n][i][0],a=t[n][i][1],r=t[n][i][2],s=t[n][i][3];o.name=n,a&&o.position.set(a[0],a[1],a[2]),r&&o.rotation.set(r[0],r[1],r[2]),s&&(o.visble=s),e.add(o)}};if(this.setHandlePickerGizmos(),t)for(var n=Object.keys(this.handleGizmos),i=0;i<n.length;i++){var o=n[i];-1===t.indexOf(o)&&(delete this.handleGizmos[o],delete this.pickerGizmos[o],delete this.hemiPickerGizmos[o])}e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(t,e){var n=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse((function(a){a.name&&(-1!=a.name.search("E")?a.quaternion.setFromRotationMatrix(o.lookAt(e,n,i)):-1==a.name.search("X")&&-1==a.name.search("Y")&&-1==a.name.search("Z")||a.quaternion.setFromEuler(t))}))},THREE.TransformGizmoTranslate=function(n){THREE.TransformGizmo.call(this,n),this.setHandlePickerGizmos=function(){var n=r(0,.05,.2,12,1,!1),i=s("X"),o=s("Y"),a=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new e({color:15805484}))]],Y:[[new THREE.Mesh(n,new t({color:768011})),[0,.5,0]],[new THREE.Line(o,new e({color:768011}))]],Z:[[new THREE.Mesh(n,new t({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new e({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),new t({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),new t({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(1.2,1.2,1.2),new t({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(n){THREE.TransformGizmo.call(this,n),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(a(1,"x",.5),new e({color:16711680}))]],RY:[[new THREE.Line(a(1,"y",.5),new e({color:65280}))]],RZ:[[new THREE.Line(a(1,"z",.5),new e({color:255}))]],RE:[[new THREE.Line(a(1.25,"z",1),new e({color:65535}))]],RXYZE:[[new THREE.Line(a(1,"z",1),new e({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,Math.PI),new t({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.12,2,24),new t({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,2,24),new t({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(t){"RE"==t&&(this.activePlane=this.planes.XYZE),"RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(t,e){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(a,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(r,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(e){THREE.TransformGizmo.call(this,e);var n=this;this.setHandlePickerGizmos=function(){var e=r(0,.05,.2,12,1,!1),n=.15;this.handleGizmos={Z:[[new THREE.Mesh(e,new t({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.015,.015,.6,4,1,!1),new t({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.015,12,60,.3*Math.PI),new t({color:16711680})),[0,0,0],[n*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.05,.05,.015,60,1,!1),new t({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.015,12,60,.3*Math.PI),new t({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.05,.05,.01,60,1,!1),new t({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,.3*Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[n*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.12,4,12,.3*Math.PI),new t({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.02,12,60,2*Math.PI),new t({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.02,12,60,2*Math.PI),new t({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereBufferGeometry(1.2,8,8,0,Math.PI),new t({color:255})),null,null,!1]]}},this.setActivePlane=function(t,e,n){if("translate"==this.activeMode){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(t,e){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,a=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).invert(),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(a,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(r,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))}},this.show=function(){this.traverse((function(t){(null==n.parent||n.parent.useAllPickers||t.parent!=n.handles)&&(t.visible=!0),t.material&&(t.material.opacity=t.material.oldOpacity),t.parent!=n.pickers&&t.parent!=n.hemiPicker&&t.parent!=n.subPickers||(t.visible=!1),t.parent!=n.planes&&t.parent!=n.highlights||(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?(e.parent!=n.highlights&&e.parent!=n.handles||(e.visible=!0),e.material.highlight(!0)):(e.material.highlight(!1),e.material.opacity=.1))}))},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(n){THREE.TransformGizmo.call(this,n),this.setHandlePickerGizmos=function(){var n=r(.125,.125,.125),i=s("X"),o=s("Y"),a=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new e({color:16711680}))]],Y:[[new THREE.Mesh(n,new t({color:65280})),[0,.5,0]],[new THREE.Line(o,new e({color:65280}))]],Z:[[new THREE.Mesh(n,new t({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new e({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),new t({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.4,.4,.4),new t({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(t,e,n){var i=new THREE.Matrix4;e.applyMatrix4(i.extractRotation(this.planes.XY.matrixWorld).invert()),"X"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,!n&&Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,!n&&Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(t,e,n,i){switch(THREE.Object3D.call(this),e=void 0!==e?e:document,this.gizmo={},n){case"translate":this.gizmo[n]=new THREE.TransformGizmoTranslate(i);break;case"rotate":this.gizmo[n]=new THREE.TransformGizmoRotate(i);break;case"transrotate":this.gizmo[n]=new THREE.TransformGizmoTranslateRotate(i);break;case"scale":this.gizmo[n]=new THREE.TransformGizmoScale(i)}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===n){var o,a=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)],r=(new THREE.BufferGeometry).setFromPoints(a),s=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(r,s),a=[new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)],r=(new THREE.BufferGeometry).setFromPoints(a),s=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1}),this.endLine=new THREE.Line(r,s),a=[new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)],r=(new THREE.BufferGeometry).setFromPoints(a),s=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1}),this.centerLine=new THREE.Line(r,s),(o=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=o.minFilter=THREE.NearestFilter,r=new THREE.CircleBufferGeometry(.1,32),s=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:o}),this.centerMark=new THREE.Mesh(r,s),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(o=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=o.minFilter=THREE.NearestFilter,s=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:o});var c=.25;this.ticks.RX=new THREE.Object3D,r=new THREE.PlaneBufferGeometry(.12,c);var l=new THREE.Mesh(r,s);l.position.set(0,0,-1.275),l.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(l),(l=l.clone()).position.set(0,1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),(l=l.clone()).position.set(0,0,1.275),l.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(l),(l=l.clone()).position.set(0,-1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),this.ticks.RY=new THREE.Object3D,(l=l.clone()).position.set(0,0,-1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),(l=l.clone()).position.set(-1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l),(l=l.clone()).position.set(0,0,1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),(l=l.clone()).position.set(1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l)}var h=this,u=!1,p=n,E={type:"change"},d={type:"mouseDown"},f={type:"mouseUp",mode:p},m={type:"objectChange"},v=(new THREE.Raycaster,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),T=new THREE.Vector3,w=new THREE.Vector3,y=new THREE.Vector3,g=1;this.clientScale=1;var R=new THREE.Matrix4,x=new THREE.Vector3,H=new THREE.Matrix4,b=new THREE.Vector3,M=new THREE.Quaternion,P=new THREE.Vector3,S=new THREE.Vector3,A=new THREE.Vector3,B=new THREE.Quaternion,C=new THREE.Quaternion,V=new THREE.Quaternion,z=new THREE.Quaternion,k=new THREE.Quaternion,I=new THREE.Vector3,O=new THREE.Vector3,G=new THREE.Matrix4,j=new THREE.Matrix4,X=new THREE.Vector3,Y=new THREE.Vector3,Z=new THREE.Euler,L=new THREE.Matrix4,_=new THREE.Vector3;function D(e,n){return THREE.TransformControls.intersectObjects(e.canvasX,e.canvasY,n,t,!0)}new THREE.Euler,this.attach=function(t){h.object=t,this.gizmo[p].show(),h.update(),h.updateUnitVectors()},this.detach=function(t){h.object=void 0,this.axis=null,this.gizmo[p].hide()},this.setMode=function(t){"scale"==(p=t||p)&&(h.space="local"),this.gizmo[p].show(),this.update(),h.dispatchEvent(E)},this.getPicker=function(){return h.gizmo[p].hemiPicker.children},this.setPosition=function(t){this.object.position.copy(t),this.update()},this.setNormal=function(t){M.setFromUnitVectors(this.normal,t),this.unitX.applyQuaternion(M),this.unitY.applyQuaternion(M),this.unitZ.applyQuaternion(M),this.normal.copy(t),this.object&&this.object.quaternion.multiply(M),this.update()},this.setRotation=function(t){this.object&&(this.object.quaternion.setFromRotationMatrix(t),this.update(),this.updateUnitVectors())},this.setSnap=function(t,e){h.snap=t,h.snapDelta=e},this.setSize=function(t){h.size=t,this.update(),h.dispatchEvent(E)},this.setSpace=function(t){h.space=t,this.update(),h.dispatchEvent(E)},this.update=function(n){if(void 0!==h.object){var i;if(h.object.updateMatrixWorld(),Y.setFromMatrixPosition(h.object.matrixWorld),Z.setFromRotationMatrix(H.extractRotation(h.object.matrixWorld)),t.updateMatrixWorld(),_.setFromMatrixPosition(t.matrixWorld),this.position.copy(Y),this.quaternion.setFromEuler(Z),this.normal.set(0,0,1),this.normal.applyEuler(Z),t.isPerspective){var o=Y.distanceTo(_);i=2*Math.tan(t.fov*Math.PI/360)*o}else i=t.top-t.bottom;var a=e.getBoundingClientRect();g=100*this.clientScale*i/a.height,this.scale.set(g,g,g),this.gizmoOffset&&this.position.add(this.gizmoOffset),this.updateMatrixWorld(),n&&this.gizmo[p].highlight(h.axis)}},this.setGizmoOffset=function(t){this.gizmoOffset=t||new THREE.Vector3(0,0,0),this.update()},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(Z),this.unitY.applyEuler(Z),this.unitZ.applyEuler(Z)},this.showRotationGizmos=function(t){for(var e=this.gizmo[p].handles.children,n=0;n<e.length;n++){var i=e[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=t)}this.useAllPickers=t},this.highlight=function(){this.gizmo[p].highlight(this.axis||"Z")},this.onPointerHover=function(t){if(void 0===h.object||!0===u)return!1;var e=D(t,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children),n=null,i="";return e&&(i=-1!=(n=e.object.name).search("R")?"rotate":"translate"),h.axis!==n&&(h.axis=n,h.gizmo[p].activeMode=i,h.update(!0),h.dispatchEvent(E)),null===h.axis&&h.gizmo[p].show(),!!e},this.isDragging=function(){return u},this.onPointerDown=function(e){if(void 0===h.object||!0===u)return!1;var n=e;if("touch"===e.pointerType){var i=null,o="";(a=D(n,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children))&&(o=-1!=(i=a.object.name).search("R")?"rotate":"translate"),h.axis!==i&&(h.axis=i,h.gizmo[p].activeMode=o)}var a=null;if((0===n.button||-1===n.button||void 0===n.button)&&(a=D(n,h.useAllPickers?h.gizmo[p].pickers.children:h.gizmo[p].subPickers.children))){h.dispatchEvent(d),h.axis=a.object.name,h.update(),x.copy(t.position).sub(Y).normalize(),h.gizmo[p].setActivePlane(h.axis,x,"local"===h.space);var r=D(n,[h.gizmo[p].activePlane]);if(r&&T.copy(r.point),I.copy(h.object.position),O.copy(h.object.scale),G.extractRotation(h.object.matrix),L.extractRotation(h.object.matrixWorld),h.object.parent?(j.extractRotation(h.object.parent.matrixWorld),X.setFromMatrixScale(H.copy(h.object.parent.matrixWorld).invert())):(j.extractRotation(h.object.matrixWorld),X.setFromMatrixScale(H.copy(h.object.matrixWorld).invert())),"transrotate"===p&&"rotate"===h.gizmo[p].activeMode){var s=h.startLine.geometry.getAttribute("position");s.setXYZ(0,0,0,0),s.setXYZ(1,0,0,1),s.applyMatrix4(h.matrixWorld),s.needsUpdate=!0,h.parent.add(h.startLine);var c=h.object.geometry.getAttribute("position"),l=(new THREE.Vector3).fromBufferAttribute(c,0).applyMatrix4(h.object.matrixWorld),E=(new THREE.Vector3).fromBufferAttribute(c,1).applyMatrix4(h.object.matrixWorld),f=(new THREE.Vector3).fromBufferAttribute(c,2).applyMatrix4(h.object.matrixWorld),m=(new THREE.Vector3).fromBufferAttribute(c,3).applyMatrix4(h.object.matrixWorld),v=h.centerLine.geometry.getAttribute("position");if("RX"===h.axis){l.lerp(f,.5),E.lerp(m,.5);var w=l.distanceTo(E);h.centerLine.material.dashSize=w/15,h.centerLine.material.gapSize=w/30,v.setXYZ(0,l.x,l.y,l.z),v.setXYZ(1,E.x,E.y,E.z)}else l.lerp(E,.5),f.lerp(m,.5),w=l.distanceTo(f),h.centerLine.material.dashSize=w/15,h.centerLine.material.gapSize=w/30,v.setXYZ(0,l.x,l.y,l.z),v.setXYZ(1,f.x,f.y,f.z);h.centerLine.computeLineDistances(),v.needsUpdate=!0,h.parent.add(h.centerLine),h.ticks[h.axis].position.copy(h.position),h.ticks[h.axis].quaternion.copy(h.quaternion),h.ticks[h.axis].scale.copy(h.scale),h.parent.add(h.ticks[h.axis])}}return u=!0,!!a},this.onPointerMove=function(t){if(void 0===h.object||null===h.axis||!1===u)return!1;var e=D(t,[h.gizmo[p].activePlane]);e&&v.copy(e.point);var n=h.gizmo[p].activeMode;if("translate"==n)v.sub(T),v.multiply(X),"local"==h.space&&(v.applyMatrix4(H.copy(L).invert()),-1==h.axis.search("X")&&(v.x=0),-1==h.axis.search("Y")&&(v.y=0),-1==h.axis.search("Z")&&(v.z=0),v.applyMatrix4(G),h.object.position.copy(I),h.object.position.add(v)),"world"!=h.space&&-1==h.axis.search("XYZ")||(P.copy(this.unitX),S.copy(this.unitY),A.copy(this.unitZ),b.set(0,0,0),-1!=h.axis.search("X")&&(P.multiplyScalar(v.dot(this.unitX)),b.add(P)),-1!=h.axis.search("Y")&&(S.multiplyScalar(v.dot(this.unitY)),b.add(S)),-1!=h.axis.search("Z")&&(A.multiplyScalar(v.dot(this.unitZ)),b.add(A)),v.copy(b),v.applyMatrix4(H.copy(j).invert()),h.object.position.copy(I),h.object.position.add(v));else if("scale"==n)v.sub(T),v.multiply(X),"local"==h.space&&("XYZ"==h.axis?(g=1+v.y/50,h.object.scale.x=O.x*g,h.object.scale.y=O.y*g,h.object.scale.z=O.z*g):(v.applyMatrix4(H.copy(L).invert()),"X"==h.axis&&(h.object.scale.x=O.x*(1+v.x/50)),"Y"==h.axis&&(h.object.scale.y=O.y*(1+v.y/50)),"Z"==h.axis&&(h.object.scale.z=O.z*(1+v.z/50))));else if("rotate"==n){if(v.sub(Y),v.multiply(X),b.copy(T).sub(Y),b.multiply(X),"RE"==h.axis){H.copy(R).invert(),v.applyMatrix4(H),b.applyMatrix4(H),w.set(Math.atan2(v.z,v.y),Math.atan2(v.x,v.z),Math.atan2(v.y,v.x)),y.set(Math.atan2(b.z,b.y),Math.atan2(b.x,b.z),Math.atan2(b.y,b.x)),M.setFromRotationMatrix(H.copy(j).invert());var i=w.z-y.z;if(null!==h.snap){var o=Math.round(i/h.snap)*h.snap;Math.abs(o-i)<h.snapDelta&&(i=o)}k.setFromAxisAngle(x,i),B.setFromRotationMatrix(L),M.multiplyQuaternions(M,k),M.multiplyQuaternions(M,B),h.object.quaternion.copy(M)}else if("RXYZE"==h.axis){var a=v.clone().cross(b).normalize();M.setFromRotationMatrix(H.copy(j).invert());var r=-v.clone().angleTo(b);null!==h.snap&&(o=Math.round(r/h.snap)*h.snap,Math.abs(o-r)<h.snapDelta&&(r=o)),C.setFromAxisAngle(a,r),B.setFromRotationMatrix(L),M.multiplyQuaternions(M,C),M.multiplyQuaternions(M,B),h.object.quaternion.copy(M)}else if("local"==h.space){H.copy(L).invert(),v.applyMatrix4(H),b.applyMatrix4(H);var s=v.dot(this.unitX),c=v.dot(this.unitY),l=v.dot(this.unitZ),d=b.dot(this.unitX),f=b.dot(this.unitY),Z=b.dot(this.unitZ);w.set(Math.atan2(l,c),Math.atan2(s,l),Math.atan2(c,s)),y.set(Math.atan2(Z,f),Math.atan2(d,Z),Math.atan2(f,d));var _=w.x-y.x,N=w.y-y.y;i=w.z-y.z,null!==h.snap&&(-1!=h.axis.search("X")&&(o=Math.round(_/h.snap)*h.snap,Math.abs(o-_)<h.snapDelta&&(_=o)),-1!=h.axis.search("Y")&&(o=Math.round(N/h.snap)*h.snap,Math.abs(o-N)<h.snapDelta&&(N=o)),-1!=h.axis.search("Z")&&(o=Math.round(i/h.snap)*h.snap,Math.abs(o-i)<h.snapDelta&&(i=o))),C.setFromAxisAngle(this.unitX,_),V.setFromAxisAngle(this.unitY,N),z.setFromAxisAngle(this.unitZ,i),B.setFromRotationMatrix(G),"RX"==h.axis&&B.multiplyQuaternions(B,C),"RY"==h.axis&&B.multiplyQuaternions(B,V),"RZ"==h.axis&&B.multiplyQuaternions(B,z),h.object.quaternion.copy(B)}else"world"==h.space&&(s=v.dot(this.unitX),c=v.dot(this.unitY),l=v.dot(this.unitZ),d=b.dot(this.unitX),f=b.dot(this.unitY),Z=b.dot(this.unitZ),w.set(Math.atan2(l,c),Math.atan2(s,l),Math.atan2(c,s)),y.set(Math.atan2(Z,f),Math.atan2(d,Z),Math.atan2(f,d)),M.setFromRotationMatrix(H.copy(j).invert()),_=w.x-y.x,N=w.y-y.y,i=w.z-y.z,null!==h.snap&&(-1!=h.axis.search("X")&&(o=Math.round(_/h.snap)*h.snap,Math.abs(o-_)<h.snapDelta&&(_=o)),-1!=h.axis.search("Y")&&(o=Math.round(N/h.snap)*h.snap,Math.abs(o-N)<h.snapDelta&&(N=o)),-1!=h.axis.search("Z")&&(o=Math.round(i/h.snap)*h.snap,Math.abs(o-i)<h.snapDelta&&(i=o))),C.setFromAxisAngle(this.unitX,_),V.setFromAxisAngle(this.unitY,N),z.setFromAxisAngle(this.unitZ,i),B.setFromRotationMatrix(L),"RX"==h.axis&&M.multiplyQuaternions(M,C),"RY"==h.axis&&M.multiplyQuaternions(M,V),"RZ"==h.axis&&M.multiplyQuaternions(M,z),M.multiplyQuaternions(M,B),h.object.quaternion.copy(M));"transrotate"===p&&(h.add(h.endLine),h.add(h.centerMark))}return h.object.matrixAutoUpdate=!0,h.update(!0),h.dispatchEvent(E),h.dispatchEvent(m),!!e},this.onPointerUp=function(t){return u&&null!==h.axis&&(f.mode=p,h.dispatchEvent(f)),u=!1,this.gizmo[p].show(),this.updateUnitVectors(),"transrotate"===p&&"rotate"===this.gizmo[p].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.intersectObjects=(n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Raycaster,function(t,e,a,r,s){var c=t/r.clientWidth*2-1,l=-e/r.clientHeight*2+1;r.isPerspective?(n.set(c,l,.5),n.unproject(r),o.set(r.position,n.sub(r.position).normalize())):(n.set(c,l,-1),n.unproject(r),i.set(0,0,-1),o.set(n,i.transformDirection(r.matrixWorld)));var h=o.intersectObjects(a,s);return h[0]?h[0]:null}),THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}(),function(){if(o)return;(o=function(t,e,n){THREE.Mesh.call(this,t,e,!1),this.plane=n,this.planeVec=new THREE.Vector4(n.normal.x,n.normal.y,n.normal.z,n.constant),this.connectivity=[],this.outline=null}).prototype=Object.create(THREE.Mesh.prototype),o.prototype.constructor=o;var t=new THREE.Vector3;o.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var e=this.plane.normal,n=-1*this.getWorldPosition(t).dot(e);this.planeVec.set(e.x,e.y,e.z,n),this.plane.constant=n}}();var X=new function(t,e){var n,i,o,a,r,s,c,h=0,u=[],p=[];function E(t){h&&clearTimeout(h),h=0,i=t,u.length=0,p.length=0,a=null,r=-1,s=0,c=0}function d(){h=0;for(var a=performance.now()+t;performance.now()<a;){if(!v())return l.invalidate(!0,!0),void E(null);n(p[c],u[s],o,c+1>=p.length,!i||r>=i.length)}h=setTimeout(d,e)}function f(){if(i&&r<i.length)for(;++r<i.length;)if((a=i[r].getInstanceTree())&&(u.length=0,a.enumNodeChildren(i[r].getRootId(),(function(t){u.push(t)}),!0),u.length>0))return o=i[r];return o=null,!1}function m(){if(s>=u.length)return!1;for(;++s<u.length;){var t=u[s];if(!a.isNodeHidden(t)&&!a.isNodeOff(t)&&(p.length=0,a.enumNodeFragments(t,(function(t){p.push(t)}),!1),p.length>0))return!0}return!1}function v(){if(++c<p.length)return!0;for(c=0;;){if(m())return!0;if(!f())return!1;s=-1}}t=t||15,e=e||0,this.start=function(t,e,i){E(t),n=i,i&&(e>=0?h=setTimeout(d,e):d())}};function Y(t){if(z){var e=Autodesk.Viewing.Extensions.CompGeom;l.sceneAfter.skipDepthTarget=!0,at();var n=new THREE.Object3D;n.name="section3D",l.scene.add(n);var i=new THREE.Object3D;i.name="section2D",l.sceneAfter.add(i);var o=e.makePlaneBasis(t),r=o.clone().invert(),s=l.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0,isScreenSpace:!0},!1,!1),c=l.matman().findMaterial(null,s);c.transparent=!0,c.depthTest=!0,c.polygonOffset=!0,c.polygonOffsetFactor=-1,c.polygonOffsetUnits=.1,c.cutplanes=L;var h,u=new THREE.Box3,p=l.modelQueue().getModels().filter((function(t){return!t.getDoNotCut()})),E=[];X.start(p,50,(function(s,p,d,v){var T=d.getFragmentList();if(T.getWorldBounds(s,u),e.xBoxPlane(t,u)){var w=T.getVizmesh(s);w.geometry&&!w.geometry.is2d&&!w.geometry.isLines&&w.material.cutplanes&&(h=w.material,e.xMeshPlane(t,w,E))}if(v){if(E.length){var y=new THREE.Box3;e.convertToPlaneCoords(o,E,y);var g=new a.VertexBufferBuilder(!1,8*E.length),R=function(t){return t&&t.color||new THREE.Color(16777215)}(h),x=0|.25*R.r*255.5,H=0|.25*R.g*255.5,b=4278190080|(0|.25*R.b*255.5)<<16|H<<8|x,M=new e.EdgeSet(E,y,1e-6*y.getSize(new THREE.Vector3).length());M.snapEdges(),M.sanitizeEdges(),M.stitchContours();var P=M.triangulate();if(P){for(var S=0;S<P.contours.length;S++)for(var A=P.contours[S],B=1;B<A.length;B++){var C=P.pts[A[B-1]],V=P.pts[A[B]];g.addSegment(C.x,C.y,V.x,V.y,0,-2,b,p,0)}var z={mesh:g.toMesh()};a.BufferGeometryUtils.meshToGeometry(z);var k=z.geometry;k.streamingDraw=!0,k.streamingIndex=!0;var I=new THREE.Mesh(k,c);if(I.matrix.copy(r),I.matrixAutoUpdate=!1,I.frustumCulled=!1,I.modelId=d.id,I.dbId=p,i.add(I),!P.triangulationFailed){var O=P.toPolygonMesh(h.packedNormals),G=l.matman().cloneMaterial(h,d);G.packedNormals=h.packedNormals,G.cutplanes=L,G.side=THREE.FrontSide,G.depthTest=!0,G.map=null,G.bumpMap=null,G.normalMap=null,G.alphaMap=null,G.specularMap=null,G.transparent=!1,G.depthWrite=!0,G.hatchPattern=!0,G.needsUpdate=!0;var j=(h.id+2)*Math.PI*.125,X=Math.tan(j);G.hatchParams=new THREE.Vector2(X,10),G.hatchTintColor=f,G.hatchTintIntensity=m,null!=G.prismType&&(G.defines={},G.defines[G.prismType.toUpperCase()]="","PrismWood"==G.prismType&&(G.defines.NO_UVW=""));var Y=new THREE.Mesh(O,G);Y.matrix.copy(r),Y.matrixAutoUpdate=!1,Y.modelId=d.id,Y.dbId=p,Y.fragId=E.fragId,n.add(Y)}}}E.length=0}}))}}var Z="Autodesk.Viewing.Extension.Section.SectionTool";l.setCutPlaneSetFor2DRendering(Z);var L=[];function _(t,e){var n,i,a=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),t.normal);if(e){var r=t.projectPoint(e.max,new THREE.Vector3),s=t.projectPoint(e.min,new THREE.Vector3),c=a.clone().invert();r.applyQuaternion(c),s.applyQuaternion(c),i=(new THREE.Vector3).subVectors(r,s),n=new THREE.PlaneBufferGeometry(i.x,i.y)}else i=2*(e=l.getVisibleBounds()).getBoundingSphere(new THREE.Sphere).radius,n=new THREE.PlaneBufferGeometry(i,i);var h=new THREE.MeshBasicMaterial({opacity:0,color:2653930,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),u=new o(n,h,t),p=t.projectPoint(e.getCenter(new THREE.Vector3),new THREE.Vector3);u.position.copy(p),u.quaternion.multiply(a);var E=l.currentLightPreset();E=Math.max(0,E);var d=Autodesk.Viewing.Private.LightPresets[E].bgColorGradient,f="rgb("+(255-d[0])+","+(255-d[1])+","+(255-d[2])+")",m=new THREE.LineBasicMaterial({color:f,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0}),v=u.geometry.getAttribute("position");n=new THREE.Geometry;for(var T=0;T<V.length;T++)n.vertices.push((new THREE.Vector3).fromBufferAttribute(v,V[T]));var w=new THREE.Line(n,m);return u.add(w),u.outline=w,u}function D(t){N((function(e){if(e instanceof o){var n;if(e.connectivity.length>0){var i=e.matrixWorld.clone().invert(),a=new THREE.Vector3;n=e.geometry.getAttribute("position");for(var r=0;r<n.count;r++){var s=e.connectivity[r];null!==it(e.plane,s[0],s[1],a)&&(a.applyMatrix4(i),n.setXYZ(r,a.x,a.y,a.z))}n.needsUpdate=!0,e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere()}else if(t){var c=l.getVisibleBounds(),h=2*c.getBoundingSphere(new THREE.Sphere).radius,u=e.plane.projectPoint(c.getCenter(new THREE.Vector3),new THREE.Vector3);e.geometry=new THREE.PlaneBufferGeometry(h,h),e.position.copy(u),n=e.geometry.getAttribute("position")}if(n){for(var p=0;p<V.length;p++)e.outline.geometry.vertices[p].fromBufferAttribute(n,V[p]);e.outline.geometry.verticesNeedUpdate=!0}}}))}function N(t){for(var e=0;e<H.length;e++)H[e].traverse(t)}function F(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];N((function(t){t instanceof o&&t.update()})),1===b.length&&Y((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)),l.setCutPlaneSet(Z,b,t)}function W(t){for(var e=0;e<H.length;e++)H[e].visible=t;d!==t&&I(),d=t}function U(t){t&&b.length>0&&(1===b.length&&Y((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)),l.setCutPlaneSet(Z,b)),W(t)}function Q(t,e){t.attach(e),t.setPosition(e.position),t.visible=!0}function q(t){return l.api.navigation.getEyeVector().dot(t)>0&&t.negate(),t}function J(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=l.getVisibleBounds(),o=i.getCenter(new THREE.Vector3),a=new THREE.Group;e=void 0!==e?e:-1*o.dot(t);var s=new THREE.Plane(t,e),c=_(s,null);a.add(c),b.push(c.planeVec),H.push(a),l.addOverlay(S,a),r&&(Q(r,c),c.material.opacity=0,K(c),r.showRotationGizmos(!0),M=r.getPicker()),F(n),u&&O()}function K(t){if(!r||!t)return!1;var e=function(t){var e=new THREE.Vector3,n=t.geometry;return n.computeBoundingBox(),e.x=(n.boundingBox.max.x+n.boundingBox.min.x)/2,e.y=(n.boundingBox.max.y+n.boundingBox.min.y)/2,e.z=(n.boundingBox.max.z+n.boundingBox.min.z)/2,t.localToWorld(e),e}(t).sub(t.position);return e.sub(c),r.setGizmoOffset(e),!0}var $,tt,et,nt,it=($=new THREE.Matrix3,tt=new THREE.Vector3,et=new THREE.Vector3,nt=new THREE.Vector3,function(t,e,n,i){$.set(t.normal.x,t.normal.y,t.normal.z,e.normal.x,e.normal.y,e.normal.z,n.normal.x,n.normal.y,n.normal.z);var o=$.determinant();return 0===o?null:(tt.crossVectors(e.normal,n.normal).multiplyScalar(-t.constant),et.crossVectors(n.normal,t.normal).multiplyScalar(-e.constant),nt.crossVectors(t.normal,e.normal).multiplyScalar(-n.constant),(i||new THREE.Vector3).copy(tt).add(et).add(nt).divideScalar(o))}),ot=function(t,e,n){return THREE.TransformControls.intersectObjects(t.canvasX,t.canvasY,e,l.camera,n)};function at(){var t=l.scene.getObjectByName("section3D");t&&l.scene.remove(t);var e=l.sceneAfter.getObjectByName("section2D");e&&l.sceneAfter.remove(e)}this.isActive=function(){return u},this.getSectionDistance=function(t){var e=l.api.navigation.getEyeVector(),n=l.rayIntersect(new THREE.Ray(l.camera.position,e));return n&&n.intersectPoint&&-1*n.intersectPoint.dot(t)},this.setViewerSection=function(){var t,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.clearSection(e);var n=l.getCutPlaneSet("__set_view");if(1===n.length){r.clientScale=1;var i=n[0];t=new THREE.Vector3(i.x,i.y,i.z);var o=i.w;J(t,o,e),P="SET_VIEW_PLANE",l.setCutPlaneSet("__set_view",void 0,e)}},this.setSection=function(e){var n,i;this.clearSection(),c=new THREE.Vector3,r.clientScale=1;var o=l.getCutPlaneSet("__set_view");switch(1===o.length&&"BOX"!==e&&"OBJ_SET_VIEW_PLANE"!==e&&(e="SET_VIEW_PLANE"),e){case"X":n=new THREE.Vector3(1,0,0),i=this.getSectionDistance(n),J(q(n),i);break;case"Y":n=new THREE.Vector3(0,1,0),i=this.getSectionDistance(n),J(q(n),i);break;case"Z":n=new THREE.Vector3(0,0,1),i=this.getSectionDistance(n),J(q(n),i);break;case"OBJ_SET_VIEW_PLANE":case"SET_VIEW_PLANE":var a=o[0];J(n=new THREE.Vector3(a.x,a.y,a.z),a.w);break;case"OBJ_BOX":case"BOX":!function(e){var n=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],i=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],o=new THREE.Group,a=l.getVisibleBounds(),c=a.getCenter(new THREE.Vector3),h=new THREE.Box3(a.min,c),u=!1;e&&6===e.length&&1===e[0].x&&(c=(h=new THREE.Box3(new THREE.Vector3(e[3].w,e[4].w,e[5].w),new THREE.Vector3(e[0].w,e[1].w,e[2].w))).max.clone(),u=!0);var p,E,d,f=new THREE.Vector3,m=new THREE.Vector3,v=[],T=[];for(p=0;p<n.length;p++){if(u)d=new THREE.Plane(n[p],e[p].w),v.push(d);else if(d=new THREE.Plane(n[p],-1*c.dot(n[p])),v.push(d),p>2){t(d,h.max,f),t(d,h.min,m);var w=(new THREE.Vector3).subVectors(f,m);d.constant-=w.length()}E=_(d,h),o.add(E),T.push(E),b.push(E.planeVec)}for(p=0;p<T.length;p++){E=T[p];for(var y=i[p],g=0;g<y.length;g++){for(var R=[],x=y[g],P=0;P<x.length;P++)R.push(v[x[P]]);E.connectivity.push(R)}}H.push(o),l.addOverlay(S,o),F(),D(),d=H[0].children[0],Q(r,d),d.material.opacity=.25,K(d),Q(s,H[0]),r.showRotationGizmos(!1),M=r.getPicker().concat(s.getPicker());var A=H[0].position.clone().sub(c.clone());s.setGizmoOffset(A)}(o),r.clientScale=2,this.recomputePivot()}P=e,l.setCutPlaneSet("__set_view",void 0)},this.setSectionFromPlane=function(t){this.clearSection(),J(new THREE.Vector3(t.x,t.y,t.z),t.w),P="",l.setCutPlaneSet("__set_view",void 0)},this.setActiveMode=function(t){P=t||""},this.setDisplaySectionHatches=function(t){z=t},this.updateCapMeshes=function(t){t&&(J(t.normal,t.constant),Y(t))},this.clearSection=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(r&&r.detach(),s&&s.detach();b.length>0;)b.pop();for(;H.length>0;){var e=H.pop();l.removeOverlay(S,e)}X.start(null),at(),l.setCutPlaneSet(Z,null,t)},this.isPlaneOn=function(){return d},this.showPlane=function(t){W(t)},this.attachControl=function(t){r&&s&&(t?(Q(r,H[0].children[0]),r.highlight(),"BOX"===P&&Q(s,H[0])):(r.detach(),s.detach()))},this.resetSection=function(){this.setSection(P)},this.getNames=function(){return h},this.getName=function(){return h[0]},this.register=function(){},this.deregister=function(){this.clearSection(),B&&(l.removeOverlay(S,r),r.removeEventListener("change",I),r=null,l.removeOverlay(S,s),s.removeEventListener("change",I),s.removeEventListener("change",G),s=null,l.removeOverlayScene(S),n.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,O),n.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,j),n.removeEventListener(Autodesk.Viewing.HIDE_EVENT,j),n.removeEventListener(Autodesk.Viewing.SHOW_EVENT,j),n.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,j),B=!1)},this.getPriority=function(){return 70},this.activate=function(){!function(){if(B)return l.addOverlay(S,r),void l.addOverlay(S,s);(r=new THREE.TransformControls(l.camera,l.canvas,"transrotate")).addEventListener("change",I),r.setSnap(Math.PI/2,Math.PI/36),(s=new THREE.TransformControls(l.camera,l.canvas,"translate")).addEventListener("change",I),s.addEventListener("change",G),void 0===l.overlayScenes.gizmo&&l.createOverlayScene(S),l.addOverlay(S,r),l.addOverlay(S,s),n.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,O),n.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,j),n.addEventListener(Autodesk.Viewing.HIDE_EVENT,j),n.addEventListener(Autodesk.Viewing.SHOW_EVENT,j),n.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,j),B=!0}(),u=!0,p=!1,C=!0,b=b||[],U(!0)},this.deactivate=function(){if(u=!1,p=!1,this.keepCutPlanesOnDeactivate){l.removeOverlay(S,r),l.removeOverlay(S,s);for(var t=0;t<H.length;t++)l.removeOverlay(S,H[t])}else X.start(null),at(),U(!1),l.setCutPlaneSet(Z);r.detach(),s.detach()},this.update=function(){return!1},this.handleSingleClick=function(t){var e,n=ot(t,null===(e=H[0])||void 0===e?void 0:e.children);if(H[0].children.forEach((function(t){t.material.opacity=0})),n){var i,o=r.object;Q(r,n.object),r.highlight(),n.object.material.opacity=b.length>1?.25:0,(null===(i=H[0])||void 0===i?void 0:i.children.length)>1&&o!==n.object&&K(n.object),I(),G()}return!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(t){return this.handleSingleClick(t,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(t){return p=!0,!!s.onPointerDown(t)||r.onPointerDown(t)},this.handleButtonUp=function(t){return p=!1,E&&(E=!1,this.recomputePivot()),!!s.onPointerUp(t)||r.onPointerUp(t)},this.handleMouseMove=function(t){var e=s.object?(new THREE.Vector3).copy(s.object.position):null;if(p){if(s.onPointerMove(t)){E=!0,F(),r.update();var n=(new THREE.Vector3).copy(s.object.position).sub(e);return c.add(n),k("Canvas","Box","translate"),!0}if(r.onPointerMove(t)){if(E=!0,F(),D(),P.includes("BOX"))k("Canvas","Box","transform");else{var i=-1!=r.axis.search("R")?"rotate":"translate";k("Canvas","Plane",i)}return!0}}if(s.visible=void 0!==s.object,"touch"!==t.pointerType){var o,a=t,l=ot(a,null===(o=H[0])||void 0===o?void 0:o.children);l&&(C=!1);var h=!!(C||l||ot(a,M,!0));r.visible=h,s.visible=s.visible&&h,W(h)}return!!s.onPointerHover(t)||r.onPointerHover(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":return A="drag",this.handleButtonDown(t,0);case"dragmove":return"drag"===A&&this.handleMouseMove(t);case"dragend":return"drag"===A&&(A=null,this.handleButtonUp(t,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!1},this.recomputePivot=function(){var t=this.getSectionBoxValues(!0);if(t){var e=t.sectionBox;l.api.navigation.setPivotPoint(new THREE.Vector3(e[0]+.5*(e[3]-e[0]),e[1]+.5*(e[4]-e[1]),e[2]+.5*(e[5]-e[2])))}},this.getSectionBoxValues=function(t){var e=H[0];if(!e)return null;var n=e.children;if(n.length<6)return null;var i=n[0].position.x,o=n[1].position.y,a=n[2].position.z,r=n[3].position.x,s=n[4].position.y,c=n[5].position.z,h={x:0,y:0,z:0};return t||(h=l.model.getData().globalOffset||h),{sectionBox:[Math.min(r,i)+h.x,Math.min(o,s)+h.y,Math.min(a,c)+h.z,Math.max(r,i)+h.x,Math.max(o,s)+h.y,Math.max(a,c)+h.z],sectionBoxTransform:(new THREE.Matrix4).identity().toArray()}},this.getSectionPlaneValues=function(t){var e=H[0];if(!e)return null;var n=e.children;if(1!==n.length)return null;var i={x:0,y:0,z:0};t||(i=l.model.getData().globalOffset||i);var o=n[0].plane,a=o.constant-THREE.Vector3.prototype.dot.call(i,o.normal);return{sectionPlane:[o.normal.x,o.normal.y,o.normal.z,a]}},this.getSectionPlaneSet=function(){return l.getCutPlaneSet(Z)},this.getSectionPlanes=function(){var t=l.getCutPlaneSet("__set_view");return t.length>0?t:l.getCutPlaneSet(Z)},this.notifyCutplanesChanged=function(){var t=L.length;L.length=0;for(var e=l.getCutPlaneSets(),n=0;n<e.length;n++){var i=e[n];if(i!==Z)for(var o=l.getCutPlaneSet(i),a=0;a<o.length;a++)L.push(o[a])}e.includes("__set_view")&&""!==P&&-1===P.indexOf("OBJ_")&&this.setViewerSection(!1),t!==L.length&&function(){function t(t){t&&t.traverse((function(t){t instanceof THREE.Mesh&&t.material&&(t.material.needsUpdate=!0)}))}t(l.scene.getObjectByName("section3D")),t(l.sceneAfter.getObjectByName("section2D"))}()},this.setSectionBox=function(t){if(!t)return!1;var e="OBJ_BOX",n=Autodesk.Viewing.Private.SceneMath.box2CutPlanes(t,t.transform);return P=e,l.setCutPlaneSet("__set_view",n),this.setSection(e),!0},this.setSectionPlane=function(t,e){var n,i,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||!e)return!1;var a="OBJ_SET_VIEW_PLANE",s=-1*e.dot(t),c=new THREE.Plane(t,s);P=a;var h=[new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant)];l.setCutPlaneSet("__set_view",h),this.setSection(a),null===(n=r)||void 0===n||n.showRotationGizmos(o);var u=e.clone().sub(H[0].children[0].position);return null===(i=r)||void 0===i||i.setGizmoOffset(u),!0}};var s=n(93379),c=n.n(s),l=n(7795),h=n.n(l),u=n(90569),p=n.n(u),E=n(3565),d=n.n(E),f=n(19216),m=n.n(f),v=n(44589),T=n.n(v),w=n(83427),y={};y.styleTagTransform=T(),y.setAttributes=d(),y.insert=p().bind(null,"head"),y.domAPI=h(),y.insertStyleElement=m();c()(w.Z,y);w.Z&&w.Z.locals&&w.Z.locals;var g=Autodesk.Viewing.Private,R=Autodesk.Viewing.UI,x=g.analytics,H=function(t,e){Autodesk.Viewing.Extension.call(this,t,e),this.viewer=t,this.name="section",this.modes=["x","y","z","box"],this.buttons={},this.onViewerSetView=this.onViewerSetView.bind(this),this._onCutPlanesChanged=this._onCutPlanesChanged.bind(this),this._onShowAll=this._onShowAll.bind(this)};H.prototype=Object.create(Autodesk.Viewing.Extension.prototype),H.prototype.constructor=H;var b=H.prototype;b.load=function(){var t=this,e=this,n=this.viewer;this.tool=new r(n,{tintColor:{r:1,g:1,b:0},tintIntensity:.2}),n.toolController.registerTool(this.tool,this.setActive.bind(this)),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],this.displaySectionHatches=this.displaySectionHatches.bind(this),this.viewer.prefs.addListeners(g.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),n.addEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),n.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),n.addEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var i=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){if(0===e.viewer.getAggregateSelection().length)return e.deactivate()}}];return n.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,i),this.viewer.registerContextMenuCallback("Autodesk.Section",(function(e,n){!function(t,e,n){var i;if(!n.hasSelected)return;var o=t.viewer,a=o.getAggregateSelection();if(1===a.length&&a[0].model.is2d())return;var r=o.impl.selector.getSelectionBounds(),s={title:"Section",target:[]};s.target.push({title:"Section Box",target:function(){t.setSectionBox(r),x.track("viewer.section",{From:"Contextual",Type:"Box",action:"Enable"})}});var c=a.map((function(t){return t.selection})).flat(),l=a.map((function(t){return t.model.id})),h=o.impl.hitTest(n.canvasX,n.canvasY,!1,c,l);if((null==h||null===(i=h.face)||void 0===i?void 0:i.normal)&&h.model&&-1!==c.indexOf(h.dbId)){var u=o.impl.getRenderProxy(h.model,h.fragId),p=(new THREE.Matrix3).getNormalMatrix(u.matrixWorld),E=h.face.normal.clone().applyMatrix3(p).normalize();s.target.push({title:"Section Plane",target:function(){t.setSectionPlane(E,h.point,!1),x.track("viewer.section",{From:"Contextual",Type:"Plane",action:"Enable"})}})}e.push(s)}(t,e,n)})),this.viewer.loadExtension("Autodesk.CompGeom")},b.unload=function(){var t=this.viewer;return t.unregisterContextMenuCallback("Autodesk.Section"),t.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),t.removeEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),t.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),t.removeEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),this.viewer.prefs.removeListeners(g.Prefs3D.DISPLAY_SECTION_HATCHES,this.displaySectionHatches),t.toolController.deregisterTool(this.tool),this.tool=null,!0},b.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var t=this.sectionStyle||"X";this.setSectionStyle(t,!0)}return this.isActive()},b.getSectionStyle=function(){return this.sectionStyle},b.setSectionStyle=function(t,e){if(-1===this.supportedStyles.indexOf(t))return!1;var n=this.isActive(),i=this.sectionStyle!==t||!e;return this.sectionStyle=t,n&&i?this.tool.setSection(t):n||(this.enableSectionTool(!0),i?this.tool.setSection(t):this.tool.attachControl(!0)),!0},b.setSectionFromPlane=function(t){if(this.deactivate(),t)this.tool.setSectionFromPlane(t),this.tool.attachControl(!1),this.isActive()||this.tool.showPlane(!1);else{this.tool.clearSection();var e=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(e)}},b.getSectionPlanes=function(){return this.tool.getSectionPlanes()},b.enableSectionTool=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.viewer.toolController,i=this.tool.isActive();if(t&&!i)return n.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!t&&i){var o=this.tool.keepCutPlanesOnDeactivate;return this.tool.keepCutPlanesOnDeactivate=e,n.deactivateTool("section"),this.tool.keepCutPlanesOnDeactivate=o,this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return t&&n.activateToolModality("section"),!1},b.getViewValues=function(t){var e=this.tool.getSectionBoxValues(t);if(e)return e;var n=this.tool.getSectionPlaneValues(t);return n||null},b.getState=function(t){if(this.viewer.model&&!this.viewer.model.is2d()){t.cutplanes=t.cutplanes||[];for(var e=this.tool.getSectionPlaneSet(),n=0;n<e.length;n++)t.cutplanes.push(e[n].toArray())}},b.restoreState=function(t){if(t.cutplanes){var e=this.getSectionPlanes();return this.setSectionFromPlane(null),1===e.length&&this.setSectionFromPlane(e[0]),!0}},b._onCutPlanesChanged=function(){this.tool.notifyCutplanesChanged()},b._onShowAll=function(){this.deactivate()},b.setSectionBox=function(t){var e;t&&(this.enableSectionTool(!0),this.tool.setSectionBox(t)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode="box",null===(e=this.buttons[this.mode])||void 0===e||e.setState(R.Button.State.ACTIVE)):this.enableSectionTool(!1))},b.setSectionPlane=function(t,e,n){var i;t&&e&&(this.enableSectionTool(!0),this.tool.setSectionPlane(t,e,n)?(this.activeStatus=!0,this.viewer.clearSelection(),this.mode=this.calculateNearestAxis(t),null===(i=this.buttons[this.mode])||void 0===i||i.setState(R.Button.State.ACTIVE)):this.enableSectionTool(!1))},b.calculateNearestAxis=function(t){var e=Math.abs(t.x),n=Math.abs(t.y),i=Math.abs(t.z);return e>=n&&e>=i?"x":n>e&&n>=i?"y":"z"},b.onViewerSetView=function(){this.deactivate()},b.onToolbarCreated=function(t){this.sectionToolButton=new R.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var e=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(e){var n=e.getControl("toolbar-resetTool");n?e.addControl(this.sectionToolButton,{index:e.indexOf(n.getId())}):e.addControl(this.sectionToolButton,{index:0})}},b.createSubmenu=function(t){var e=this,n=this.viewer;function i(t,n){return e.buttons[n]=t,function(){var i=t.getState(),o=function(){t instanceof R.ComboButton==!1?e.activate(n):(e.enableSectionTool(!0),e.tool.attachControl(!0))},a=-1!==n.toLowerCase().indexOf("box")?"Box":"Plane";i===R.Button.State.INACTIVE?(t.setState(R.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(o,1):o(),x.track("viewer.section",{From:"Toolbar",Type:a,action:"Enable"})):i===R.Button.State.ACTIVE&&(t.setState(R.Button.State.INACTIVE),e.deactivate(),x.track("viewer.section",{From:"Toolbar",Type:a,action:"Disable"})),e.sectionStyle=n.toUpperCase()}}function o(){var t,i=(t=new THREE.Vector3,function(e,n,i){return t.subVectors(e,n),t.lengthSq()<i}),o=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),s=n.autocam.getWorldRightVector(),c=n.autocam.getWorldUpVector(),l=n.autocam.getWorldFrontVector(),h=1e-4;i(c,o,h)?e.sectionYButton.setIcon("adsk-icon-plane-x"):i(c,r,h)?e.sectionYButton.setIcon("adsk-icon-plane-z"):e.sectionYButton.setIcon("adsk-icon-plane-y"),i(s,a,h)?e.sectionXButton.setIcon("adsk-icon-plane-y"):i(s,r,h)?e.sectionXButton.setIcon("adsk-icon-plane-z"):e.sectionXButton.setIcon("adsk-icon-plane-x"),i(l,o,h)?e.sectionZButton.setIcon("adsk-icon-plane-x"):i(l,a,h)?e.sectionZButton.setIcon("adsk-icon-plane-y"):e.sectionZButton.setIcon("adsk-icon-plane-z")}var a=this.sectionXButton=new R.Button("toolbar-sectionTool-x");a.setToolTip("Add X plane"),a.setIcon("adsk-icon-plane-x"),a.onClick=i(a,"x"),t.addControl(a);var r=this.sectionYButton=new R.Button("toolbar-sectionTool-y");r.setToolTip("Add Y plane"),r.setIcon("adsk-icon-plane-y"),r.onClick=i(r,"y"),t.addControl(r);var s=this.sectionZButton=new R.Button("toolbar-sectionTool-z");s.setToolTip("Add Z plane"),s.setIcon("adsk-icon-plane-z"),s.onClick=i(s,"z"),t.addControl(s);var c=this.sectionBoxButton=new R.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=i(c,"box"),t.addControl(c),n.model?o():n.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,o,{once:!0})},b.destroyUI=function(){this.sectionToolButton&&(this.sectionToolButton.removeFromParent(),this.sectionToolButton=null,this.buttons={})},b.activate=function(t){if(!this.activeStatus||this.mode!==t){switch(this.enableSectionTool(!0),t){default:this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},b.deactivate=function(t){return!!this.activeStatus&&(this.tool.setActiveMode(""),this.enableSectionTool(!1,t),this.activeStatus=!1,!0)},b.displaySectionHatches=function(t){var e=this;if(this.tool.setDisplaySectionHatches(t),this.activeStatus){var n=this.getSectionPlanes();this.tool.clearSection(),n.forEach((function(t){e.tool.updateCapMeshes((new THREE.Plane).setComponents(t.x,t.y,t.z,t.w))}))}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",H)})(),Autodesk.Extensions.Section=i})();
//# sourceMappingURL=Section.min.js.map